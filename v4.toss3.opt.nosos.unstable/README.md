# Collection build notes:

The rpms here are NOT relocatable in any way, since they follow the 
Software Collections guidelines instead. They omit the SOS store
and its python dependencies.

Daemons install to /opt/ovis/sandia-nosos-ovis\_4.3.3
Runtime files appear in /var/opt/ovis/sandia-nosos-ovis\_4.3.3/run.

To Build it all:

Install the dependencies listed at the end, then:

./fireovis
and then install the resulting:
```
sandia-nosos-ovis-ldms_4.3.3-runtime
```

./firepapi
and then install
```
sandia-nosos-ovis_ldms_4.3.3-ovis-papi
sandia-nosos-ovis_ldms_4.3.3-ovis-papi-devel
```

./fireldms
and then install at least
```
sandia-nosos-ovis_ldms_4.3.3-ovis-ldms
sandia-nosos-ovis_ldms_4.3.3-ovis-ldms-devel
```

./firellnllustre  

# Installation:

If you have an RPM repository set up containing all the rpms 
generated by fire\*, you should then be able
to install convenience package:
```
sandia-nosos-ovis-ldms_4.3.3
with
yum install sandia-nosos-ovis-ldms_4.3.3 sandia-nosos-ovis_ldms_4.3.3-llnl-lustre
```

You can create an RPM repo from the files created by fire\*
running the 'root-makerepo' script.
It's use is an exercise left to the reader. You probably want
to specify a directory other than the build tree for the repo.

Then set up systemd links after rpm install:
```
scl register /opt/ovis/sandia-nosos-ovis-ldms_4.3.3
systemctl link /opt/ovis/sandia-nosos-ovis-ldms_4.3.3/root/usr/lib/systemd/system/sandia-nosos-ovis-ldms_4.3.3-ldmsd.service
systemctl link /opt/ovis/sandia-nosos-ovis-ldms_4.3.3/root/usr/lib/systemd/system/sandia-nosos-ovis-ldms_4.3.3-ldmsd@.service
```
but note on redhat 7, systemd is buggy and linking the ldmsd@.service will fail.
The workaround is:
```
(cd /etc/systemd/system && \
ln -s /opt/ovis/sandia-nosos-ovis-ldms_4.3.3/root/usr/lib/systemd/system/sandia-nosos-ovis-ldms_4.3.3-ldmsd@.service . && \
systemctl daemon-reload)
```
Then to get the daemon running, you will need to (per your site tastes) fix the authentication 
to be a real authentication secret file or a symbolic link, perhaps with a link:
```
cd /etc/opt/ovis/sandia-nosos-ovis-ldms_4.3.3/sysconfig/ldms.d/ClusterSecrets
ln -s /etc/sysconfig/ldms.d/ClusterSecrets/ldmsauth.conf .
ln -s ./ldmsauth.conf agg.ldmsauth.conf
ln -s ./ldmsauth.conf local.ldmsauth.conf
```
and note that ldmsauth.conf must contain a valid secretword line and have permissions 600.


# Using ldmsd manually:

You will need to enable the collection.
```
scl --list ; should show sandia-nosos-ovis-ldms_4.3.3
scl enable sandia-nosos-ovis-ldms_4.3.3 bash ; start a shell with the ovis paths set
```

Dependencies:
	gcc
	rpm-build
	scl-utils
	scl-utils-build
	bison bison-devel
	flex flex-devel
	boost-devel
	doxygen
	genders
	gettext-devel
	libibverbs-devel
	librabbitmq librabbitmq-devel
	librdmacm-devel
	openssl openssl-devel
	python2 python2-devel
	swig
	lustre 2
